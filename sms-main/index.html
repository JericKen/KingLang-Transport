<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TextBee SMS Sender</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #4b55a2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: white;
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 500px;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 1.5rem;
            font-size: 2rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            color: #555;
            font-weight: 600;
        }

        input, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            font-family: inherit;
        }

        input:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .character-count {
            text-align: right;
            font-size: 12px;
            color: #888;
            margin-top: 5px;
        }

        .send-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #6079e9 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .send-btn:hover {
            transform: translateY(-2px);
        }

        .send-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        .response {
            margin-top: 1rem;
            padding: 15px;
            border-radius: 10px;
            display: none;
        }

        .response.success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .response.error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .info-box {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 1.5rem;
            color: #1565c0;
        }

        .info-box h3 {
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        .info-box p {
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .api-info {
            font-size: 12px;
            color: #666;
            text-align: center;
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Free text for PH numbers</h1>

        <form id="smsForm">
            <div class="form-group">
                <label for="phoneNumber">Philippine Mobile Number</label>
                <input type="tel" id="phoneNumber" placeholder="Ex: 09171234567" required maxlength="11">
                <small style="color: #666; font-size: 12px; margin-top: 5px; display: block;">
                    Enter your mobile: 09171234567, 09181234567, etc.
                </small>
                <div id="phonePreview" style="font-size: 12px; margin-top: 5px; color: #4CAF50; display: none;">
                    Will send to: <span id="formattedNumber"></span>
                </div>
            </div>

            <div class="form-group">
                <label for="message">Message</label>
                <textarea id="message" placeholder="Enter your SMS message here..." maxlength="160" required></textarea>
                <div class="character-count">
                    <span id="charCount">0</span>/160
                </div>
            </div>

            <button type="submit" class="send-btn" id="sendBtn">
                Send Message
            </button>
        </form>

        <div id="response" class="response"></div>

        <div class="api-info">
           Follow me on Github <a href="https://github.com/Davezu" target="_blank" style="color: #667eea;">Davezu</a> For more projects.
        </div>
    </div>

    <script>
        const API_KEY = 'b7746b27-f405-404e-b958-0221d5ed48a7';
        const DEVICE_ID = '689f381ff6706f717bb34d20';
        const API_BASE_URL = 'https://api.textbee.dev/api/v1/gateway';



        // Character counter
        const messageInput = document.getElementById('message');
        const charCount = document.getElementById('charCount');

        messageInput.addEventListener('input', function() {
            const count = this.value.length;
            charCount.textContent = count;
            
            if (count > 140) {
                charCount.style.color = '#ff6b6b';
            } else if (count > 120) {
                charCount.style.color = '#ffa726';
            } else {
                charCount.style.color = '#888';
            }
        });

        document.getElementById('smsForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const phoneNumber = document.getElementById('phoneNumber').value.trim();
            const message = document.getElementById('message').value.trim();
            const sendBtn = document.getElementById('sendBtn');
            const response = document.getElementById('response');

            if (!phoneNumber || !message) {
                showResponse('Please fill in all fields.', 'error');
                return;
            }

            let formattedPhone = phoneNumber;
            if (formattedPhone.startsWith('09') && formattedPhone.length === 11) {
                formattedPhone = '+63' + formattedPhone.substring(1);
            } else if (!formattedPhone.startsWith('+63')) {
                showResponse('❌ Please enter a valid Philippine mobile number (09xxxxxxxxx)', 'error');
                return;
            }

            sendBtn.disabled = true;
            sendBtn.textContent = '⏳ Sending...';

            try {
                const requestBody = {
                    recipients: [formattedPhone],
                    message: message
                };

                console.log('Sending request to:', `${API_BASE_URL}/devices/${DEVICE_ID}/send-sms`);
                console.log('Request body:', requestBody);

                const apiResponse = await fetch(`${API_BASE_URL}/devices/${DEVICE_ID}/send-sms`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': API_KEY
                    },
                    body: JSON.stringify(requestBody)
                });

                const responseData = await apiResponse.json();
                
                if (apiResponse.ok) {
                    showResponse(`✅ SMS sent successfully to ${formattedPhone}!`, 'success');
                    document.getElementById('smsForm').reset();
                    charCount.textContent = '0';
                } else {
                    console.error('API Error:', responseData);
                    const errorMessage = responseData.message || responseData.error || 'Failed to send SMS';
                    showResponse(`❌ Error: ${errorMessage}`, 'error');
                }
            } catch (error) {
                console.error('Network Error:', error);
                showResponse(`❌ Network error: ${error.message}`, 'error');
            } finally {
                // Re-enable button
                sendBtn.disabled = false;
                sendBtn.textContent = '📤 Send SMS';
            }
        });

        function showResponse(message, type) {
            const response = document.getElementById('response');
            response.textContent = message;
            response.className = `response ${type}`;
            response.style.display = 'block';
            
            if (type === 'success') {
                setTimeout(() => {
                    response.style.display = 'none';
                }, 5000);
            }
        }

        document.getElementById('phoneNumber').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            const phonePreview = document.getElementById('phonePreview');
            const formattedNumber = document.getElementById('formattedNumber');
            
            if (value.length > 11) {
                value = value.substring(0, 11);
            }
            
            if (value.startsWith('09') && value.length >= 10) {
                e.target.value = value;
                
                if (value.length === 11) {
                    const international = '+63' + value.substring(1);
                    formattedNumber.textContent = international;
                    phonePreview.style.display = 'block';
                } else {
                    phonePreview.style.display = 'none';
                }
            } else if (value.startsWith('9') && value.length >= 9 && !value.startsWith('09')) {
                value = '0' + value;
                if (value.length <= 11) {
                    e.target.value = value;
                }
                
                if (value.length === 11) {
                    const international = '+63' + value.substring(1);
                    formattedNumber.textContent = international;
                    phonePreview.style.display = 'block';
                }
            } else {
                e.target.value = value;
                phonePreview.style.display = 'none';
            }
        });
    </script>
</body>
</html>
